# Cathedral OS - Clock Hormesis Profiles
# =======================================
#
# Clock abuse = σ_clock in the metal
# Same principle as logical stress: dose it, measure T_s/A_g, find the sweet spot.
#
# Each profile is pre-validated via clock_sweep.py
# The controller only toggles between these blessed states.

# =============================================================================
# GPU PROFILES (NVIDIA 3090 example)
# =============================================================================

gpu_profiles:
  gpu_3090_safe:
    description: "Stock settings, maximum reliability"
    device_type: "gpu"
    device_model: "RTX 3090"
    base_clock_mhz: 1725
    offset_mhz: 0
    base_voltage_mv: 1000
    offset_mv: 0
    mem_clock_offset_mhz: 0
    power_limit_w: 320
    temp_limit_c: 83
    # Measured deltas from sweep
    Ts_delta: 0.00
    Ag_delta: 0.00
    error_rate_per_1M: 0.0
    aggression_score: 0.0
    allowed: true

  gpu_3090_hormesis:
    description: "Mild OC, validated stable under stress"
    device_type: "gpu"
    device_model: "RTX 3090"
    base_clock_mhz: 1725
    offset_mhz: +60
    base_voltage_mv: 1000
    offset_mv: -20          # Undervolted for efficiency
    mem_clock_offset_mhz: +200
    power_limit_w: 330
    temp_limit_c: 80
    # Measured deltas
    Ts_delta: +0.01         # Slightly better stability under load
    Ag_delta: +0.005        # Small antifragility gain
    error_rate_per_1M: 0.0
    aggression_score: 0.2
    allowed: true
    notes: "Sweet spot for 24/7 operation. +8% throughput, -5% power/op"

  gpu_3090_burst:
    description: "High OC for batch jobs, not 24/7"
    device_type: "gpu"
    device_model: "RTX 3090"
    base_clock_mhz: 1725
    offset_mhz: +120
    base_voltage_mv: 1000
    offset_mv: 0
    mem_clock_offset_mhz: +400
    power_limit_w: 350
    temp_limit_c: 85
    Ts_delta: -0.02
    Ag_delta: -0.01
    error_rate_per_1M: 0.1
    aggression_score: 0.5
    allowed: true
    max_continuous_minutes: 30
    notes: "Use for batch inference, stress tests. Requires cooldown."

  gpu_3090_danger:
    description: "Beyond safe envelope - blacklisted"
    device_type: "gpu"
    device_model: "RTX 3090"
    base_clock_mhz: 1725
    offset_mhz: +200
    offset_mv: +50
    mem_clock_offset_mhz: +800
    power_limit_w: 380
    temp_limit_c: 90
    Ts_delta: -0.08
    Ag_delta: -0.05
    error_rate_per_1M: 15.0
    aggression_score: 1.0
    allowed: false
    notes: "VRAM errors observed. DO NOT USE."

# =============================================================================
# CPU PROFILES (AMD Threadripper example)
# =============================================================================

cpu_profiles:
  tr_3970x_safe:
    description: "Stock, PBO disabled"
    device_type: "cpu"
    device_model: "Threadripper 3970X"
    base_clock_mhz: 3700
    all_core_offset_mhz: 0
    voltage_offset_mv: 0
    pbo_enabled: false
    power_limit_w: 280
    temp_limit_c: 85
    Ts_delta: 0.00
    Ag_delta: 0.00
    error_rate_per_1M: 0.0
    aggression_score: 0.0
    allowed: true

  tr_3970x_eco:
    description: "Undervolted for 24/7 daemon cores"
    device_type: "cpu"
    device_model: "Threadripper 3970X"
    base_clock_mhz: 3700
    all_core_offset_mhz: -100
    voltage_offset_mv: -50
    pbo_enabled: false
    power_limit_w: 200
    temp_limit_c: 75
    Ts_delta: +0.02         # More stable due to lower temps
    Ag_delta: +0.01
    error_rate_per_1M: 0.0
    aggression_score: -0.2  # Negative = more conservative
    allowed: true
    notes: "Best for Ara brain cores. 30% less power, trivial perf loss."

  tr_3970x_hormesis:
    description: "PBO + mild undervolt"
    device_type: "cpu"
    device_model: "Threadripper 3970X"
    base_clock_mhz: 3700
    all_core_offset_mhz: 0
    voltage_offset_mv: -30
    pbo_enabled: true
    pbo_scalar: 5
    power_limit_w: 300
    temp_limit_c: 80
    Ts_delta: +0.005
    Ag_delta: +0.008
    error_rate_per_1M: 0.0
    aggression_score: 0.3
    allowed: true
    notes: "Let PBO do its thing with safety margin."

# =============================================================================
# FPGA PROFILES (K10 / Stratix example)
# =============================================================================

fpga_profiles:
  k10_safe:
    description: "Stock PLL settings"
    device_type: "fpga"
    device_model: "K10 Superscalar"
    core_clock_mhz: 400
    io_clock_mhz: 200
    voltage_mv: 850
    power_limit_w: 1845
    temp_limit_c: 75
    Ts_delta: 0.00
    Ag_delta: 0.00
    error_rate_per_1M: 0.0
    aggression_score: 0.0
    allowed: true

  k10_hormesis:
    description: "Mild overclock, validated with BIST"
    device_type: "fpga"
    device_model: "K10 Superscalar"
    core_clock_mhz: 430
    io_clock_mhz: 215
    voltage_mv: 870
    power_limit_w: 2000
    temp_limit_c: 70
    Ts_delta: +0.01
    Ag_delta: +0.006
    error_rate_per_1M: 0.0
    aggression_score: 0.25
    allowed: true
    notes: "+7.5% hashrate. BIST passes at 48hr stress."

  k10_turbo:
    description: "Maximum validated overclock"
    device_type: "fpga"
    device_model: "K10 Superscalar"
    core_clock_mhz: 460
    io_clock_mhz: 230
    voltage_mv: 900
    power_limit_w: 2200
    temp_limit_c: 65
    Ts_delta: -0.01
    Ag_delta: +0.002
    error_rate_per_1M: 0.5
    aggression_score: 0.5
    allowed: true
    max_continuous_minutes: 60
    notes: "+15% hashrate. Monitor temps closely."

  k10_danger:
    description: "Beyond safe - timing failures observed"
    device_type: "fpga"
    device_model: "K10 Superscalar"
    core_clock_mhz: 500
    io_clock_mhz: 250
    voltage_mv: 950
    power_limit_w: 2500
    temp_limit_c: 80
    Ts_delta: -0.10
    Ag_delta: -0.08
    error_rate_per_1M: 50.0
    aggression_score: 1.0
    allowed: false
    notes: "BRAM checksum failures. DO NOT USE."

# =============================================================================
# CONTROLLER WEIGHTS
# =============================================================================

controller:
  # J = α·T̄_s + β·Ā_g - γ·P̄_norm - δ·aggression
  alpha: 0.5              # Weight on topology stability
  beta: 0.4               # Weight on antifragility gain
  gamma: 0.1              # Penalty on power
  delta_clock: 0.05       # Penalty on clock aggression

  # Safety constraints
  max_aggression: 0.6     # Don't go beyond this
  error_rate_threshold: 1.0  # Max errors per 1M ops
  temp_headroom_c: 5      # Stay this far below limit

# =============================================================================
# SWEEP SETTINGS (for clock_sweep.py)
# =============================================================================

sweep:
  # GPU sweep parameters
  gpu:
    clock_steps: [0, +30, +60, +90, +120, +150, +180]
    voltage_steps: [-50, -30, -20, 0, +20]
    mem_clock_steps: [0, +200, +400, +600, +800]
    test_duration_sec: 60
    cooldown_sec: 30

  # CPU sweep parameters
  cpu:
    clock_steps: [-200, -100, 0, +100, +200]
    voltage_steps: [-75, -50, -30, 0]
    pbo_scalars: [1, 5, 10]
    test_duration_sec: 120
    cooldown_sec: 60

  # FPGA sweep parameters
  fpga:
    core_clock_steps: [400, 415, 430, 445, 460, 475, 500]
    io_clock_steps: [200, 210, 220, 230, 240, 250]
    voltage_steps: [850, 870, 900, 930]
    test_duration_sec: 300
    cooldown_sec: 120

  # Universal pass criteria
  pass_criteria:
    determinism_check: true      # Same input → same output hash
    max_error_rate_per_1M: 0.0   # Zero tolerance for sweep
    max_Ts_drop: 0.05            # Don't lose more than 5% T_s
    min_Ag: -0.02                # A_g can go slightly negative
