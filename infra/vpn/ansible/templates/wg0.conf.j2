# =============================================================================
# Ara WireGuard Configuration
# =============================================================================
# Generated by Ansible - DO NOT EDIT MANUALLY
# Regenerate with: ansible-playbook -i hosts.ini vpn_pop.yml --tags wireguard
# =============================================================================

[Interface]
# {{ inventory_hostname }}
Address = {{ wg_address }}/24
ListenPort = {{ wg_port }}
PrivateKey = {{ wg_actual_key }}

# Post-up: Enable IP forwarding and NAT
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o {{ nat_interface }} -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o {{ nat_interface }} -j MASQUERADE

{% if wg_peers | length > 0 %}
# =============================================================================
# Peers
# =============================================================================
{% for peer in wg_peers %}

[Peer]
# {{ peer.name | default('Unnamed peer') }}
PublicKey = {{ peer.public_key }}
AllowedIPs = {{ peer.allowed_ips }}
{% if peer.endpoint is defined %}
Endpoint = {{ peer.endpoint }}
{% endif %}
{% if peer.preshared_key is defined %}
PresharedKey = {{ peer.preshared_key }}
{% endif %}
PersistentKeepalive = {{ peer.keepalive | default(25) }}

{% endfor %}
{% else %}
# No peers configured yet.
# Add peers via Ansible variables or manually with:
#   wg set {{ wg_interface }} peer <PUBLIC_KEY> allowed-ips <IP>/32
{% endif %}
