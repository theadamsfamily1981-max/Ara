# OpenOCD Configuration for ATCA Boards with Xilinx FPGAs
# Advanced Telecommunications Computing Architecture
#
# Usage: openocd -f atca_xilinx.cfg

# ============================================================================
# JTAG Adapter Configuration
# ============================================================================

# ATCA boards typically use:
# - RJ45 JTAG connectors (need JTAG-over-Ethernet or adapter)
# - Standard 14-pin Xilinx header (less common)
# - Built-in JTAG access via shelf manager (if available)

# For direct JTAG access via FT2232H
adapter driver ftdi
ftdi_vid_pid 0x0403 0x6010

ftdi_layout_init 0x0088 0x008b
ftdi_layout_signal nTRST -data 0x0010 -oe 0x0010
ftdi_layout_signal nSRST -data 0x0020 -oe 0x0020

# JTAG speed (conservative for long cables)
adapter speed 5000

# ============================================================================
# Common ATCA FPGA Configurations
# ============================================================================

# ATCA boards often have multiple FPGAs in a chain
# Example: Fabric FPGA + Switch FPGA + Management FPGA

# Virtex-7 (Common in ATCA-4000 series)
# IDCODE: 0x03651093 (XC7V690T), 0x03671093 (XC7V2000T)
jtag newtap virtex7_fabric tap -irlen 6 -expected-id 0x03651093 -expected-id 0x03671093

# Virtex-6 (Older ATCA boards)
# IDCODE: 0x04244093 (XC6VLX240T), 0x04250093 (XC6VLX365T)
# jtag newtap virtex6 tap -irlen 10 -expected-id 0x04244093 -expected-id 0x04250093

# Virtex UltraScale+ (Newer ATCA boards)
# IDCODE: 0x04B31093 (VU9P), 0x04B51093 (VU13P)
# jtag newtap virtex_ultrascale tap -irlen 6 -expected-id 0x04B31093 -expected-id 0x04B51093

# Create target
target create atca_fpga.fpga testee -chain-position virtex7_fabric.tap

# ============================================================================
# ATCA-Specific Notes
# ============================================================================

# Common ATCA Boards with Salvageable FPGAs:
#
# 1. Emerson/Artesyn ATCA-7485 (Virtex-7 690T)
#    - 4x 10GbE ports
#    - 64GB DDR3
#    - Dual FPGAs (fabric + switch)
#
# 2. Kontron ATCA-4310 (Virtex-6 LX240T)
#    - AMC bays (additional FPGAs)
#    - PCIe Gen2 backplane
#
# 3. Advantech ATCA-9301 (Virtex UltraScale+ VU9P)
#    - 100GbE support
#    - Modern, high-performance
#
# 4. Radisys ATCA-5000 (Virtex-7 V2000T)
#    - Massive fabric FPGA (2M logic cells)
#    - High-end telecom switching

# ============================================================================
# JTAG Chain for Multi-FPGA ATCA Boards
# ============================================================================

# Many ATCA boards have 2-3 FPGAs in JTAG chain:
# 1. Fabric FPGA (main processing)
# 2. Switch FPGA (backplane interface)
# 3. Management FPGA (IPMI, shelf manager)

# Example: Dual Virtex-7 configuration
# jtag newtap virtex7_fabric tap -irlen 6 -expected-id 0x03651093
# jtag newtap virtex7_switch tap -irlen 6 -expected-id 0x03651093
# target create fpga0.fpga testee -chain-position virtex7_fabric.tap
# target create fpga1.fpga testee -chain-position virtex7_switch.tap

# ============================================================================
# ATCA Shelf Manager Integration
# ============================================================================

# Some ATCA systems allow JTAG access through the shelf manager (IPMI)
# For remote access without physical JTAG cable:
#
# 1. SSH to shelf manager
# 2. Enable JTAG passthrough to blade
# 3. Use JTAG-over-Ethernet proxy

# Example (vendor-specific):
# shelf_manager> enable_jtag blade 3
# shelf_manager> jtag_proxy_port 2222

# Then use remote OpenOCD:
# openocd -c "adapter driver remote_bitbang" -c "remote_bitbang_host shelf_ip" -c "remote_bitbang_port 2222"

# ============================================================================
# Configuration Flash (ATCA Specifics)
# ============================================================================

# ATCA boards typically use:
# - BPI Flash (x16 parallel NOR) - larger capacity (256MB-1GB)
# - Dual flash for redundancy (golden + application image)

# Many ATCA boards have write-protect jumpers or switches
# Check board documentation before attempting flash erase!

# ============================================================================
# Power Considerations
# ============================================================================

# ATCA boards draw power from backplane (48V DC)
# If testing standalone:
# - Need ATCA power supply or bench supply (48V, 20-40A)
# - Check power enable pins (some boards need enable signal)
# - Monitor current draw (100W-300W typical for FPGA blades)

# ============================================================================
# Useful Commands
# ============================================================================

# Scan ATCA JTAG chain:
#   openocd -f atca_xilinx.cfg -c "init; scan_chain; shutdown"
#
# Read FPGA IDCODE:
#   openocd -f atca_xilinx.cfg -c "init; irscan virtex7_fabric.tap 0x09; drscan virtex7_fabric.tap 32 0; shutdown"
#
# Program bitstream (use Vivado for ATCA boards):
#   vivado -mode batch -source program_atca.tcl
